# Generated by https://smithery.ai. See: https://smithery.ai/docs/build/project-config
FROM node:lts-alpine

# Install build dependencies
RUN apk add --no-cache git python3 make g++ \
    && npm install -g pnpm

WORKDIR /app

# Copy monorepo manifests
COPY pnpm-lock.yaml pnpm-workspace.yaml package.json ./
COPY package ./package
COPY mcp ./mcp

# Install all dependencies
RUN pnpm install --frozen-lockfile

# Build the shared SDK
RUN pnpm --filter sdk build

# Link built SDK into mcp workspace for Next build resolution
RUN mkdir -p mcp/node_modules && ln -s /app/package mcp/node_modules/sdk

# Build the Next.js MCP server
RUN cd mcp && pnpm build

# Expose HTTP port
EXPOSE 3000
ENV PORT 3000

# Start the MCP HTTP server
CMD ["npm", "run", "start", "--prefix", "mcp"]
